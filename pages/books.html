<h3>Магазин</h3>
<form id="catalog" class="form-inline panel" action="getBooks">
	<div class="form-group clearfix">
		<input id="search" class="form-control" name="search" placeholder="...."/>
	</div>
	<div class="form-group clearfix">
		<select id="orderby" class="form-control" name="orderby">
			<option value="format">Формат</option>
			<option value="rating">Рейтинг</option>
			<option value="price">Цена</option>
		</select>
	</div>
	<div class="form-group clearfix">
		<select id="direction" class="form-control" name="direction">
			<option value="asc">asc</option>
			<option value="desc">desc</option>
		</select>
	</div>
	<button type="submit" class="btn btn-primary">Найти</button>
</form>
<div id="books" class="list-group">
	<div id="headers" style="display:none;" class="list-group-item clearfix">
		<span class="col-md-8"><strong>Название</strong></span>
		<span class="col-md-2 text-right"><strong>Наличие</strong></span>
		<span class="col-md-2"></span>
	</div>
</div>
<script>
	{
		//display books
		let getBooks=data=>{
			lib.alert(data.rows.length==0?'Книги не найдены':'Найдено книг: '+data.rows.length);
			$('#headers').toggle(data.rows.length>0);
			let list=$('#books');
			list.children('form').remove();
			data.rows.forEach(
				r=>{
					console.log(r);
					$('<form/>',{class:'form buy list-group-item clearfix',action:'buyBook',method:'post'})
						.append($('<span/>',{class:'col-8'}).html(r.title+' '+r.authors_list.length))
						.append(
							$('<span/>',{class:'col-2 text-right'})
							.append($('<input/>',{name:'onhand_qty',value:r.onhand_qty,type:'number',min:'1',step:'1',class:'form-control txt-right'}))
							.append($('<button/>',{type:'submit',class:'btn btn-success pull-right'}).html('Заказать'))
						)
						.append(
							$('<span/>',{class:'col-2 text-nowrap'})
							//.append($('<input/>',{type:'hidden',name:'book_id',value:r.book_id}))
							//.append($('<button/>',{type:'submit',class:'btn btn-success pull-right'}).html('Купить'))
						)
						.appendTo(list)
					;
				}
			);
		}

		lib.ajaxForm('#catalog',getBooks);
		/*
		lib.ajaxForm(
			'.buy',
			data=>{
				lib.alert('Вы купили книгу','success');
				lib.server('findBooks',$('#catalog').serialize(),findBooks);
			}
		);
		*/
	}
</script>
