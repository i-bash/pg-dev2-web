<h3>Магазин</h3>
<form id="catalog" class="form-inline panel" action="getBooks">
	<div class="form-group clearfix">
		<input id="search" class="form-control" name="search" placeholder="...."/>
	</div>
	<div class="form-group clearfix">
		<select id="orderby" class="form-control" name="orderby">
			<option value="format">Формат</option>
			<option value="rating">Рейтинг</option>
			<option value="price">Цена</option>
		</select>
	</div>
	<div class="form-group clearfix">
		<select id="direction" class="form-control" name="direction">
			<option value="asc">asc</option>
			<option value="desc">desc</option>
		</select>
	</div>
	<button type="submit" class="btn btn-primary">Найти</button>
</form>
<div id="books" class="container">
	<div id="headers" style="display:none;" class="row">
		<span class="col-6 font-weight-bold"><strong>Название</strong></span>
		<span class="col-3 font-weight-bold text-center"><strong>Наличие</strong></span>
		<span class="col-3 font-weight-bold text-center">Стоимость</span>
	</div>
</div>
<script>
	{
		//display books
		lib.ajaxForm(
			'#catalog',
			data=>{
				lib.alert(data.rows.length==0?'Книги не найдены':'Найдено книг: '+data.rows.length);
				$('#headers').toggle(data.rows.length>0);
				let list=$('#books');
				list.children('div:not(:first-child)').remove();
				data.rows.forEach(
					r=>{
						$('<div/>',{class:'row'})
							.append($('<span/>',{class:'col-6 my-auto'}).html(r.title+' '+r.authors_list.length))
							.append(
								$('<form/>',{class:'form form-inline col-3 my-auto',action:'orderBook',method:'post'})
								.append($('<input/>',{type:'hidden',name:'book_id',value:r.book_id}))
								.append($('<input/>',{type:'number',name:'qty',value:r.onhand_qty,min:'1',step:'1',class:'form-control text-right'}))
								.append($('<input/>',{type:'hidden',name:'price',value:999}))
								.append($('<button/>',{type:'submit',class:'btn btn-primary btn-sm'}).html('Заказать'))
							)
							.append(
								$('<form/>',{class:'form form-inline col-3 my-auto',action:'setPrice',method:'post'})
								.append($('<input/>',{type:'hidden',name:'book_id',value:r.book_id}))
								.append($('<input/>',{type:'number',name:'price',value:r.price,min:'1',class:'form-control text-right'}))
								.append($('<button/>',{type:'submit',class:'btn btn-primary btn-sm'}).html('Установить'))
							)
							.appendTo(list)
						;
					}
				);
			}
		);
		lib.ajaxForm(
			'#books form[action="orderBook"]',
			data=>{}
		);
		lib.ajaxForm(
			'#books form[action="setPrice"]',
			data=>{}
		);
	}
</script>
